<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G·ª≠i Th√¥ng B√°o Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f1f5f9;
        }

        .header h1 {
            color: #1e293b;
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            color: #64748b;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 500;
            display: none;
        }

        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .status.loading {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .quick-actions {
            margin-top: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
        }

        .quick-actions h3 {
            margin-bottom: 15px;
            color: #374151;
            font-size: 16px;
        }

        .quick-btn {
            display: inline-block;
            margin: 5px;
            padding: 8px 12px;
            background: #e5e7eb;
            color: #374151;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .quick-btn:hover {
            background: #d1d5db;
        }

        .history {
            margin-top: 30px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }

        .history-item {
            padding: 10px 15px;
            border-bottom: 1px solid #f3f4f6;
            font-size: 13px;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-time {
            color: #6b7280;
            font-size: 11px;
        }

        .notification-preview {
            margin-top: 15px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }

        .preview-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .preview-message {
            color: #4b5563;
            margin-bottom: 8px;
        }

        .preview-meta {
            font-size: 12px;
            color: #6b7280;
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìß G·ª≠i Th√¥ng B√°o Test</h1>
            <p>C√¥ng c·ª• test g·ª≠i notification th√¥ng qua WebSocket</p>
        </div>

        <form id="notificationForm">
            <div class="form-row">
                <div class="form-group">
                    <label for="userId">User ID <span style="color: red;">*</span></label>
                    <input type="number" id="userId" required placeholder="Nh·∫≠p User ID" value="16378">
                </div>
                <div class="form-group">
                    <label for="notificationType">Lo·∫°i th√¥ng b√°o</label>
                    <select id="notificationType">
                        <!-- KH√ìA H·ªåC / H·ªåC T·∫¨P -->
                        <option value="COURSE_NEW_CONTENT">üìö N·ªôi dung kh√≥a h·ªçc m·ªõi</option>
                        <option value="COURSE_ACCESS_EXPIRY">‚è∞ H·∫øt h·∫°n truy c·∫≠p kh√≥a h·ªçc</option>

                        <!-- THI C·ª¨ / MOCK TEST -->
                        <option value="QUIZ_REGISTER_SUCCESS">‚úÖ ƒêƒÉng k√Ω Mock test th√†nh c√¥ng</option>
                        <option value="QUIZ_RESULT">üìä K·∫øt qu·∫£ thi</option>
                        <option value="QUIZ_REMINDER">üìù Nh·∫Øc nh·ªü l√†m b√†i</option>

                        <!-- THANH TO√ÅN / ƒê∆†N H√ÄNG -->
                        <option value="PAYMENT_SUCCESS">üí∞ Thanh to√°n th√†nh c√¥ng</option>
                        <option value="PAYMENT_FAILED">‚ùå Thanh to√°n th·∫•t b·∫°i</option>
                        <option value="ORDER_REFUNDED">üí∏ Ho√†n ti·ªÅn</option>
                        <option value="ORDER_CANCELED">üö´ H·ªßy ƒë∆°n</option>
                        <option value="PAYMENT_PENDING_REMINDER">‚è≥ Nh·∫Øc thanh to√°n</option>
                        <option value="INVOICE_AVAILABLE">üßæ H√≥a ƒë∆°n c√≥ s·∫µn</option>

                        <!-- KHUY·∫æN M√ÉI / ∆ØU ƒê√ÉI -->
                        <option value="PROMOTION_NEW_VOUCHER">üé´ Voucher m·ªõi</option>
                        <option value="PROMOTION_FLASH_SALE">‚ö° Flash sale</option>
                        <option value="PROMOTION_PERSONALIZED">üéØ ∆Øu ƒë√£i c√° nh√¢n</option>

                        <!-- H·ªÜ TH·ªêNG / T√ÄI KHO·∫¢N -->
                        <option value="SYSTEM_INFO">‚ÑπÔ∏è Th√¥ng tin h·ªá th·ªëng</option>
                        <option value="SYSTEM_POLICY_UPDATE">üìã C·∫≠p nh·∫≠t ch√≠nh s√°ch</option>
                        <option value="SYSTEM_MAINTENANCE">üîß B·∫£o tr√¨ h·ªá th·ªëng</option>
                        <option value="ACCOUNT_SECURITY_ALERT">üîí C·∫£nh b√°o b·∫£o m·∫≠t</option>
                        <option value="ACCOUNT_LOCKED">üö® Kh√≥a t√†i kho·∫£n</option>

                        <!-- AFFILIATE / C·ªòNG T√ÅC VI√äN -->
                        <option value="AFFILIATE_APPLICATION_RESULT">üìù K·∫øt qu·∫£ affiliate</option>
                        <option value="AFFILIATE_COMMISSION">üíº Hoa h·ªìng affiliate</option>
                        <option value="AFFILIATE_WITHDRAWAL_STATUS">üí≥ Tr·∫°ng th√°i r√∫t ti·ªÅn</option>

                        <!-- H·ªñ TR·ª¢ / CSKH -->
                        <option value="SUPPORT_TICKET_REPLY">üí¨ Tr·∫£ l·ªùi ticket h·ªó tr·ª£</option>
                        <option value="SUPPORT_CHANNEL_SUGGESTION">üí° G·ª£i √Ω k√™nh h·ªó tr·ª£</option>
                        <option value="MENTOR_FEEDBACK">üë®‚Äçüè´ Ph·∫£n h·ªìi mentor</option>

                        <!-- T∆Ø∆†NG T√ÅC C∆† B·∫¢N -->
                        <option value="POST_NEW_COMMENT">üí¨ B√¨nh lu·∫≠n m·ªõi</option>
                        <option value="COMMENT_REPLY">‚Ü©Ô∏è Tr·∫£ l·ªùi b√¨nh lu·∫≠n</option>
                        <option value="POST_NEW_REACTION">üëç React b√†i vi·∫øt</option>
                        <option value="COMMENT_NEW_REACTION">‚ù§Ô∏è React b√¨nh lu·∫≠n</option>

                        <!-- GI·ªÆ CH√ÇN & G·ª¢I √ù -->
                        <option value="RETENTION_INACTIVE_REMINDER">üîî Nh·∫Øc quay l·∫°i</option>
                        <option value="RETENTION_UNFINISHED_COURSE">üìñ Ho√†n th√†nh kh√≥a h·ªçc</option>
                        <option value="RETENTION_NEW_CHAPTER_OPEN">üìÑ Ch∆∞∆°ng m·ªõi</option>
                        <option value="RECOMMEND_ROLE_BASED">üéØ G·ª£i √Ω theo role</option>
                        <option value="RECOMMEND_WEAKNESS_FOCUS">üìà C·∫£i thi·ªán ƒëi·ªÉm y·∫øu</option>
                        <option value="RECOMMEND_MOCK_TEST_READY">üéì Mock test s·∫µn s√†ng</option>
                        <option value="RECOMMEND_RELATED_ARTICLE">üì∞ B√†i vi·∫øt li√™n quan</option>

                        <!-- M·∫†NG X√É H·ªòI -->
                        <option value="SOCIAL_INVITE_FRIEND">üë• M·ªùi b·∫°n b√®</option>
                        <option value="SOCIAL_INVITE_REWARD">üéÅ Th∆∞·ªüng m·ªùi b·∫°n</option>
                        <option value="SOCIAL_ADMIN_POST">üëë B√†i vi·∫øt admin</option>
                        <option value="SOCIAL_COMMUNITY_HIGHLIGHT">‚≠ê B√†i vi·∫øt n·ªïi b·∫≠t</option>
                        <option value="SOCIAL_FOLLOWING_NEW_POST">üì¢ B√†i vi·∫øt ng∆∞·ªùi theo d√µi</option>
                        <option value="SOCIAL_TRENDING_CONTENT">üî• N·ªôi dung trending</option>
                        <option value="SOCIAL_WATCHED_POST_COMMENT">üëÄ B√¨nh lu·∫≠n b√†i theo d√µi</option>

                        <!-- C·ªòNG ƒê·ªíNG -->
                        <option value="COMMUNITY_QUESTION_ANSWERED">‚ùì Tr·∫£ l·ªùi c√¢u h·ªèi</option>
                        <option value="COMMUNITY_MENTION">@Ô∏è‚É£ Nh·∫Øc ƒë·∫øn b·∫°n</option>
                        <option value="COMMUNITY_POST_REACTION">üëç Upvote b√†i vi·∫øt</option>
                        <option value="COMMUNITY_TOPIC_MESSAGE">üíå Tin nh·∫Øn topic</option>
                        <option value="COMMUNITY_ROLE_ASSIGNED">üëî G√°n role m·ªõi</option>

                        <!-- B·∫¢O M·∫¨T & C·∫¨P NH·∫¨T -->
                        <option value="SECURITY_NEW_DEVICE_LOGIN">üÜï ƒêƒÉng nh·∫≠p thi·∫øt b·ªã m·ªõi</option>
                        <option value="SECURITY_SUSPICIOUS_ACTIVITY">‚ö†Ô∏è Ho·∫°t ƒë·ªông b·∫•t th∆∞·ªùng</option>
                        <option value="SYSTEM_APP_UPDATE_AVAILABLE">üì± C·∫≠p nh·∫≠t app m·ªõi</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="title">Ti√™u ƒë·ªÅ <span style="color: red;">*</span></label>
                <input type="text" id="title" required placeholder="Nh·∫≠p ti√™u ƒë·ªÅ th√¥ng b√°o" maxlength="255">
            </div>

            <div class="form-group">
                <label for="message">N·ªôi dung <span style="color: red;">*</span></label>
                <textarea id="message" required placeholder="Nh·∫≠p n·ªôi dung th√¥ng b√°o..."></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="actionUrl">Action URL (t√πy ch·ªçn)</label>
                    <input type="text" id="actionUrl" placeholder="/orders/123, /quiz/456...">
                </div>
                <div class="form-group">
                    <label for="objectId">Object ID (t√πy ch·ªçn)</label>
                    <input type="number" id="objectId" placeholder="123 (ID ƒë∆°n h√†ng, quiz, kh√≥a h·ªçc...)">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="srcUserId">Src User ID (t√πy ch·ªçn)</label>
                    <input type="number" id="srcUserId" placeholder="ID ng∆∞·ªùi th·ª±c hi·ªán h√†nh ƒë·ªông">
                </div>
                <div class="form-group">
                    <label for="srcObjectType">Lo·∫°i ƒë·ªëi t∆∞·ª£ng (t√πy ch·ªçn)</label>
                    <select id="srcObjectType">
                        <option value="">-- Ch·ªçn lo·∫°i --</option>
                        <option value="order">üì¶ ƒê∆°n h√†ng (Order)</option>
                        <option value="quiz">üìù B√†i thi (Quiz)</option>
                        <option value="course">üìö Kh√≥a h·ªçc (Course)</option>
                        <option value="comment">üí¨ B√¨nh lu·∫≠n (Comment)</option>
                        <option value="feed">üì∞ B√†i vi·∫øt (Feed)</option>
                    </select>
                </div>
            </div>

            <div class="btn-group">
                <button type="submit" class="btn-primary">üì§ G·ª≠i Th√¥ng B√°o</button>
                <button type="button" id="clearBtn" class="btn-secondary">üóëÔ∏è X√≥a Form</button>
            </div>
        </form>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h3>‚ö° Th√¥ng b√°o nhanh</h3>
            <button class="quick-btn" onclick="fillQuickNotification('payment_success')">üí∞ Thanh to√°n th√†nh c√¥ng</button>
            <button class="quick-btn" onclick="fillQuickNotification('payment_failed')">‚ùå Thanh to√°n th·∫•t b·∫°i</button>
            <button class="quick-btn" onclick="fillQuickNotification('quiz_result')">üìä K·∫øt qu·∫£ thi</button>
            <button class="quick-btn" onclick="fillQuickNotification('course_new_content')">üìö N·ªôi dung kh√≥a h·ªçc m·ªõi</button>
            <button class="quick-btn" onclick="fillQuickNotification('promotion_flash_sale')">‚ö° Flash sale</button>
            <button class="quick-btn" onclick="fillQuickNotification('system_maintenance')">üîß B·∫£o tr√¨ h·ªá th·ªëng</button>
            <button class="quick-btn" onclick="fillQuickNotification('security_alert')">üîí C·∫£nh b√°o b·∫£o m·∫≠t</button>
            <button class="quick-btn" onclick="fillQuickNotification('post_new_comment')">üí¨ B√¨nh lu·∫≠n m·ªõi</button>
            <button class="quick-btn" onclick="fillQuickNotification('community_mention')">@Ô∏è‚É£ Nh·∫Øc ƒë·∫øn b·∫°n</button>
            <button class="quick-btn" onclick="fillQuickNotification('retention_reminder')">üîî Nh·∫Øc quay l·∫°i</button>
        </div>

        <!-- Payment Notification Section -->
        <div class="quick-actions" style="border: 2px solid #3b82f6; background: linear-gradient(135deg, #dbeafe 0%, #f0f9ff 100%);">
            <h3>üí≥ Th√¥ng b√°o thanh to√°n chuy√™n d·ª•ng</h3>
            <div style="margin: 15px 0;">
                <div class="form-row">
                    <div class="form-group" style="margin-bottom: 10px;">
                        <label for="paymentUserId" style="font-size: 12px;">User ID:</label>
                        <input type="number" id="paymentUserId" value="16378" style="padding: 6px; font-size: 12px;">
                    </div>
                    <div class="form-group" style="margin-bottom: 10px;">
                        <label for="paymentOrderId" style="font-size: 12px;">Order ID:</label>
                        <input type="number" id="paymentOrderId" value="12345" style="padding: 6px; font-size: 12px;">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group" style="margin-bottom: 10px;">
                        <label for="paymentOrderTotal" style="font-size: 12px;">S·ªë ti·ªÅn:</label>
                        <input type="text" id="paymentOrderTotal" value="500,000 VND" style="padding: 6px; font-size: 12px;">
                    </div>
                    <div class="form-group" style="margin-bottom: 10px;">
                        <label for="paymentReason" style="font-size: 12px;">L√Ω do (n·∫øu th·∫•t b·∫°i):</label>
                        <input type="text" id="paymentReason" value="Th·∫ª kh√¥ng ƒë·ªß ti·ªÅn" style="padding: 6px; font-size: 12px;">
                    </div>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <button class="quick-btn" onclick="sendPaymentNotification('success')" style="background: #10b981; color: white; margin: 5px 10px; padding: 10px 15px;">
                        ‚úÖ G·ª≠i th√¥ng b√°o th√†nh c√¥ng
                    </button>
                    <button class="quick-btn" onclick="sendPaymentNotification('failed')" style="background: #ef4444; color: white; margin: 5px 10px; padding: 10px 15px;">
                        ‚ùå G·ª≠i th√¥ng b√°o th·∫•t b·∫°i
                    </button>
                </div>
            </div>
        </div>

        <!-- Notification Preview -->
        <div class="notification-preview" id="notificationPreview" style="display: none;">
            <div class="preview-title" id="previewTitle"></div>
            <div class="preview-message" id="previewMessage"></div>
            <div class="preview-meta">
                <span id="previewType"></span>
                <span id="previewTime"></span>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="status" class="status"></div>

        <!-- History -->
        <div class="history" id="history" style="display: none;">
            <div style="padding: 10px 15px; background: #f3f4f6; font-weight: 600; font-size: 14px;">
                üìã L·ªãch s·ª≠ g·ª≠i th√¥ng b√°o
            </div>
        </div>
    </div>

    <script>
        // Form elements
        const form = document.getElementById('notificationForm');
        const userIdInput = document.getElementById('userId');
        const titleInput = document.getElementById('title');
        const messageInput = document.getElementById('message');
        const typeSelect = document.getElementById('notificationType');
        const actionUrlInput = document.getElementById('actionUrl');
        const objectIdInput = document.getElementById('objectId');
        const srcUserIdInput = document.getElementById('srcUserId');
        const srcObjectTypeSelect = document.getElementById('srcObjectType');
        const clearBtn = document.getElementById('clearBtn');
        const status = document.getElementById('status');
        const history = document.getElementById('history');
        const preview = document.getElementById('notificationPreview');

        // Quick notification templates
        const quickTemplates = {
            payment_success: {
                type: 'PAYMENT_SUCCESS',
                title: 'üí∞ Thanh to√°n th√†nh c√¥ng!',
                message: 'C·∫£m ∆°n b·∫°n ƒë√£ thanh to√°n. ƒê∆°n h√†ng #12345 ƒë√£ ƒë∆∞·ª£c x√°c nh·∫≠n v·ªõi s·ªë ti·ªÅn 500,000 VND.',
                actionUrl: '/orders/12345',
                objectId: '12345',
                srcUserId: '16378',
                srcObjectType: 'order'
            },
            payment_failed: {
                type: 'PAYMENT_FAILED',
                title: '‚ùå Thanh to√°n th·∫•t b·∫°i',
                message: 'ƒê∆°n h√†ng #12346 thanh to√°n th·∫•t b·∫°i: Th·∫ª kh√¥ng ƒë·ªß ti·ªÅn. Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin thanh to√°n.',
                actionUrl: '/orders/12346',
                objectId: '12346',
                srcUserId: '16378',
                srcObjectType: 'order'
            },
            quiz_result: {
                type: 'QUIZ_RESULT',
                title: 'üìä C√≥ k·∫øt qu·∫£ b√†i thi',
                message: 'K·∫øt qu·∫£ b√†i thi "Java Programming Advanced" ƒë√£ c√≥. B·∫°n ƒë·∫°t 85/100 ƒëi·ªÉm. Ch√∫c m·ª´ng!',
                actionUrl: '/quiz/789/result',
                objectId: '789',
                srcUserId: '1',
                srcObjectType: 'quiz'
            },
            course_new_content: {
                type: 'COURSE_NEW_CONTENT',
                title: 'üìö N·ªôi dung kh√≥a h·ªçc m·ªõi',
                message: 'Kh√≥a h·ªçc "Spring Boot Master Class" c√≥ n·ªôi dung m·ªõi: "Microservices Architecture". H√£y xem ngay!',
                actionUrl: '/course/456',
                objectId: '456',
                srcUserId: '1',
                srcObjectType: 'course'
            },
            promotion_flash_sale: {
                type: 'PROMOTION_FLASH_SALE',
                title: '‚ö° Flash Sale ƒë·∫∑c bi·ªát!',
                message: 'Flash Sale 70% t·∫•t c·∫£ kh√≥a h·ªçc trong 24h ti·∫øp theo. ƒê·ª´ng b·ªè l·ª° c∆° h·ªôi v√†ng n√†y!',
                actionUrl: '/promotion/flash-sale',
                objectId: '999',
                srcUserId: '1',
                srcObjectType: 'course'
            },
            system_maintenance: {
                type: 'SYSTEM_MAINTENANCE',
                title: 'üîß Th√¥ng b√°o b·∫£o tr√¨ h·ªá th·ªëng',
                message: 'H·ªá th·ªëng s·∫Ω ƒë∆∞·ª£c b·∫£o tr√¨ t·ª´ 2:00 - 4:00 s√°ng ng√†y mai. Trong th·ªùi gian n√†y, m·ªôt s·ªë t√≠nh nƒÉng c√≥ th·ªÉ b·ªã gi√°n ƒëo·∫°n.',
                actionUrl: '/system-status',
                objectId: '',
                srcUserId: '1',
                srcObjectType: ''
            },
            security_alert: {
                type: 'ACCOUNT_SECURITY_ALERT',
                title: 'üîí C·∫£nh b√°o b·∫£o m·∫≠t',
                message: 'Ch√∫ng t√¥i ph√°t hi·ªán ƒëƒÉng nh·∫≠p t·ª´ thi·∫øt b·ªã m·ªõi. N·∫øu kh√¥ng ph·∫£i b·∫°n, vui l√≤ng ƒë·ªïi m·∫≠t kh·∫©u ngay l·∫≠p t·ª©c.',
                actionUrl: '/profile/security',
                objectId: '',
                srcUserId: '1',
                srcObjectType: ''
            },
            post_new_comment: {
                type: 'POST_NEW_COMMENT',
                title: 'üí¨ C√≥ b√¨nh lu·∫≠n m·ªõi',
                message: 'C√≥ ng∆∞·ªùi ƒë√£ b√¨nh lu·∫≠n v√†o b√†i vi·∫øt "Kinh nghi·ªám h·ªçc Java" c·ªßa b·∫°n.',
                actionUrl: '/post/123',
                objectId: '123',
                srcUserId: '456',
                srcObjectType: 'feed'
            },
            community_mention: {
                type: 'COMMUNITY_MENTION',
                title: '@Ô∏è‚É£ B·∫°n ƒë∆∞·ª£c nh·∫Øc ƒë·∫øn',
                message: '@john_doe ƒë√£ nh·∫Øc ƒë·∫øn b·∫°n trong b√†i vi·∫øt v·ªÅ Spring Security.',
                actionUrl: '/community/post/789',
                objectId: '789',
                srcUserId: '456',
                srcObjectType: 'feed'
            },
            retention_reminder: {
                type: 'RETENTION_INACTIVE_REMINDER',
                title: 'üîî Nh·∫Øc nh·ªü quay l·∫°i h·ªçc',
                message: 'B·∫°n ƒë√£ kh√¥ng h·ªçc trong 3 ng√†y r·ªìi. H√£y ti·∫øp t·ª•c h√†nh tr√¨nh h·ªçc t·∫≠p ƒë·ªÉ ƒë·∫°t m·ª•c ti√™u nh√©!',
                actionUrl: '/dashboard',
                objectId: '',
                srcUserId: '1',
                srcObjectType: ''
            }
        };

        // Fill quick notification
        function fillQuickNotification(type) {
            const template = quickTemplates[type];
            if (template) {
                typeSelect.value = template.type;
                titleInput.value = template.title;
                messageInput.value = template.message;
                actionUrlInput.value = template.actionUrl;
                objectIdInput.value = template.objectId;
                srcUserIdInput.value = template.srcUserId;
                srcObjectTypeSelect.value = template.srcObjectType;

                updatePreview();
                showStatus('ƒê√£ ƒëi·ªÅn template ' + type, 'success');
            }
        }

        // Update preview
        function updatePreview() {
            const title = titleInput.value.trim();
            const message = messageInput.value.trim();
            const type = typeSelect.value;

            if (title && message) {
                document.getElementById('previewTitle').textContent = title;
                document.getElementById('previewMessage').textContent = message;
                document.getElementById('previewType').textContent = type;

                // Format time in Vietnam timezone
                const vietnamTime = new Date().toLocaleString('vi-VN', {
                    timeZone: 'Asia/Ho_Chi_Minh',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                document.getElementById('previewTime').textContent = vietnamTime;

                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        }

        // Show status message
        function showStatus(message, type) {
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';

            if (type !== 'loading') {
                setTimeout(() => {
                    status.style.display = 'none';
                }, 5000);
            }
        }

        // Add to history
        function addToHistory(notification, success) {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';

            // Format time in Vietnam timezone
            const vietnamTime = new Date().toLocaleString('vi-VN', {
                timeZone: 'Asia/Ho_Chi_Minh',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });

            const icon = success ? '‚úÖ' : '‚ùå';
            const statusText = success ? 'Th√†nh c√¥ng' : 'Th·∫•t b·∫°i';

            historyItem.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>${icon} ${notification.title}</strong>
                        <div style="color: #6b7280; font-size: 11px;">User ID: ${notification.userId} | Type: ${notification.type}</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="color: ${success ? '#059669' : '#dc2626'}; font-weight: 600; font-size: 12px;">${statusText}</div>
                        <div class="history-time">${vietnamTime}</div>
                    </div>
                </div>
            `;

            history.appendChild(historyItem);
            history.style.display = 'block';

            // Keep only last 10 items
            const items = history.querySelectorAll('.history-item');
            if (items.length > 11) { // +1 for header
                items[1].remove(); // Remove oldest (skip header)
            }
        }

        // Send notification
        async function sendNotification(notificationData) {
            const params = new URLSearchParams();
            params.append('userId', notificationData.userId);
            params.append('title', notificationData.title);
            params.append('message', notificationData.message);
            params.append('type', notificationData.type);

            if (notificationData.actionUrl) {
                params.append('actionUrl', notificationData.actionUrl);
            }

            if (notificationData.objectId) {
                params.append('objectId', notificationData.objectId);
            }

            if (notificationData.srcUserId) {
                params.append('srcUserId', notificationData.srcUserId);
            }

            if (notificationData.srcObjectType) {
                params.append('srcObjectType', notificationData.srcObjectType);
            }

            try {
                const response = await fetch('/api/notifications/test-send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: params
                });

                const result = await response.json(); // Parse as JSON to get ApiResponse

                if (response.ok && result.code === 200) {
                    // Success case
                    const successMessage = result.message || '‚úÖ Th√¥ng b√°o ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng!';
                    showStatus(successMessage, 'success');
                    addToHistory(notificationData, true);
                    return true;
                } else {
                    // Error case - API returned error in ApiResponse format
                    const errorMessage = result.message || `Server error: ${response.status}`;
                    throw new Error(errorMessage);
                }
            } catch (error) {
                // Network error or other exceptions
                let errorMessage = error.message;
                if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                    errorMessage = 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng ki·ªÉm tra server c√≥ ƒëang ch·∫°y kh√¥ng.';
                } else if (error.name === 'SyntaxError') {
                    errorMessage = 'Server tr·∫£ v·ªÅ d·ªØ li·ªáu kh√¥ng h·ª£p l·ªá. Vui l√≤ng ki·ªÉm tra logs server.';
                }

                showStatus(`‚ùå L·ªói g·ª≠i th√¥ng b√°o: ${errorMessage}`, 'error');
                addToHistory(notificationData, false);
                return false;
            }
        }

        // Send payment notification using dedicated endpoints
        async function sendPaymentNotification(type) {
            const userId = document.getElementById('paymentUserId').value.trim();
            const orderId = document.getElementById('paymentOrderId').value.trim();

            if (!userId || !orderId) {
                showStatus('‚ùå Vui l√≤ng ƒëi·ªÅn User ID v√† Order ID!', 'error');
                return;
            }

            const params = new URLSearchParams();
            params.append('userId', userId);
            params.append('orderId', orderId);

            let endpoint = '';
            let notificationData = {
                userId: userId,
                title: '',
                message: '',
                type: '',
                actionUrl: `/orders/${orderId}`,
                objectId: orderId,
                srcUserId: userId,
                srcObjectType: 'order'
            };

            if (type === 'success') {
                const orderTotal = document.getElementById('paymentOrderTotal').value.trim();
                params.append('orderTotal', orderTotal || '500,000 VND');
                params.append('srcUserId', userId);

                endpoint = '/api/notifications/payment/success';
                notificationData.title = '‚úÖ Thanh to√°n th√†nh c√¥ng!';
                notificationData.message = `ƒê∆°n h√†ng #${orderId} ƒë√£ ƒë∆∞·ª£c thanh to√°n th√†nh c√¥ng v·ªõi s·ªë ti·ªÅn ${orderTotal || '500,000 VND'}`;
                notificationData.type = 'PAYMENT_SUCCESS';
            } else if (type === 'failed') {
                const reason = document.getElementById('paymentReason').value.trim();
                params.append('reason', reason || 'Th·∫ª kh√¥ng ƒë·ªß ti·ªÅn');
                params.append('srcUserId', userId);

                endpoint = '/api/notifications/payment/failed';
                notificationData.title = '‚ùå Thanh to√°n th·∫•t b·∫°i';
                notificationData.message = `ƒê∆°n h√†ng #${orderId} thanh to√°n th·∫•t b·∫°i: ${reason || 'Th·∫ª kh√¥ng ƒë·ªß ti·ªÅn'}`;
                notificationData.type = 'PAYMENT_FAILED';
            }

            showStatus('üì§ ƒêang g·ª≠i th√¥ng b√°o thanh to√°n...', 'loading');

            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: params
                });

                const result = await response.json();

                if (response.ok && result.code === 200) {
                    const successMessage = result.message || '‚úÖ Th√¥ng b√°o thanh to√°n ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng!';
                    showStatus(successMessage, 'success');
                    addToHistory(notificationData, true);
                } else {
                    const errorMessage = result.message || `Server error: ${response.status}`;
                    throw new Error(errorMessage);
                }
            } catch (error) {
                let errorMessage = error.message;
                if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                    errorMessage = 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng ki·ªÉm tra server c√≥ ƒëang ch·∫°y kh√¥ng.';
                }

                showStatus(`‚ùå L·ªói g·ª≠i th√¥ng b√°o thanh to√°n: ${errorMessage}`, 'error');
                addToHistory(notificationData, false);
            }
        }

        // Form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const notificationData = {
                userId: userIdInput.value.trim(),
                title: titleInput.value.trim(),
                message: messageInput.value.trim(),
                type: typeSelect.value,
                actionUrl: actionUrlInput.value.trim(),
                objectId: objectIdInput.value.trim(),
                srcUserId: srcUserIdInput.value.trim(),
                srcObjectType: srcObjectTypeSelect.value
            };

            if (!notificationData.userId || !notificationData.title || !notificationData.message) {
                showStatus('‚ùå Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc!', 'error');
                return;
            }

            showStatus('üì§ ƒêang g·ª≠i th√¥ng b√°o...', 'loading');
            await sendNotification(notificationData);
        });

        // Clear form
        clearBtn.addEventListener('click', function() {
            form.reset();
            userIdInput.value = '16378'; // Keep default user ID
            preview.style.display = 'none';
            showStatus('üóëÔ∏è ƒê√£ x√≥a form', 'success');
        });

        // Real-time preview
        [titleInput, messageInput, typeSelect].forEach(element => {
            element.addEventListener('input', updatePreview);
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('üìß C√¥ng c·ª• g·ª≠i th√¥ng b√°o ƒë√£ s·∫µn s√†ng!', 'success');
        });
    </script>
</body>
</html>
